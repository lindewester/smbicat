\usepackage{amssymb,amsmath,stmaryrd,txfonts,mathrsfs,amsthm}
\usepackage[all,2cell]{xy}
\usepackage[neveradjust]{paralist}
\usepackage{hyperref}
\usepackage{mathtools}

\makeatletter
\let\ea\expandafter

%% Defining commands that are always in math mode.
\def\mdef#1#2{\ea\ea\ea\gdef\ea\ea\noexpand#1\ea{\ea\ensuremath\ea{#2}}}
\def\alwaysmath#1{\ea\ea\ea\global\ea\ea\ea\let\ea\ea\csname your@#1\endcsname\csname #1\endcsname
  \ea\def\csname #1\endcsname{\ensuremath{\csname your@#1\endcsname}}}

% Script letters
\newcommand{\sA}{\ensuremath{\mathscr{A}}}
\newcommand{\sB}{\ensuremath{\mathscr{B}}}
\newcommand{\sC}{\ensuremath{\mathscr{C}}}
\newcommand{\sD}{\ensuremath{\mathscr{D}}}
\newcommand{\sE}{\ensuremath{\mathscr{E}}}
\newcommand{\sF}{\ensuremath{\mathscr{F}}}
\newcommand{\sG}{\ensuremath{\mathscr{G}}}
\newcommand{\sH}{\ensuremath{\mathscr{H}}}
\newcommand{\sI}{\ensuremath{\mathscr{I}}}
\newcommand{\sJ}{\ensuremath{\mathscr{J}}}
\newcommand{\sK}{\ensuremath{\mathscr{K}}}
\newcommand{\sL}{\ensuremath{\mathscr{L}}}
\newcommand{\sM}{\ensuremath{\mathscr{M}}}
\newcommand{\sN}{\ensuremath{\mathscr{N}}}
\newcommand{\sO}{\ensuremath{\mathscr{O}}}
\newcommand{\sP}{\ensuremath{\mathscr{P}}}
\newcommand{\sQ}{\ensuremath{\mathscr{Q}}}
\newcommand{\sR}{\ensuremath{\mathscr{R}}}
\newcommand{\sS}{\ensuremath{\mathscr{S}}}
\newcommand{\sT}{\ensuremath{\mathscr{T}}}
\newcommand{\sU}{\ensuremath{\mathscr{U}}}
\newcommand{\sV}{\ensuremath{\mathscr{V}}}
\newcommand{\sW}{\ensuremath{\mathscr{W}}}
\newcommand{\sX}{\ensuremath{\mathscr{X}}}
\newcommand{\sY}{\ensuremath{\mathscr{Y}}}
\newcommand{\sZ}{\ensuremath{\mathscr{Z}}}

% Calligraphic letters
\newcommand{\cA}{\ensuremath{\mathcal{A}}}
\newcommand{\cB}{\ensuremath{\mathcal{B}}}
\newcommand{\cC}{\ensuremath{\mathcal{C}}}
\newcommand{\cD}{\ensuremath{\mathcal{D}}}
\newcommand{\cE}{\ensuremath{\mathcal{E}}}
\newcommand{\cF}{\ensuremath{\mathcal{F}}}
\newcommand{\cG}{\ensuremath{\mathcal{G}}}
\newcommand{\cH}{\ensuremath{\mathcal{H}}}
\newcommand{\cI}{\ensuremath{\mathcal{I}}}
\newcommand{\cJ}{\ensuremath{\mathcal{J}}}
\newcommand{\cK}{\ensuremath{\mathcal{K}}}
\newcommand{\cL}{\ensuremath{\mathcal{L}}}
\newcommand{\cM}{\ensuremath{\mathcal{M}}}
\newcommand{\cN}{\ensuremath{\mathcal{N}}}
\newcommand{\cO}{\ensuremath{\mathcal{O}}}
\newcommand{\cP}{\ensuremath{\mathcal{P}}}
\newcommand{\cQ}{\ensuremath{\mathcal{Q}}}
\newcommand{\cR}{\ensuremath{\mathcal{R}}}
\newcommand{\cS}{\ensuremath{\mathcal{S}}}
\newcommand{\cT}{\ensuremath{\mathcal{T}}}
\newcommand{\cU}{\ensuremath{\mathcal{U}}}
\newcommand{\cV}{\ensuremath{\mathcal{V}}}
\newcommand{\cW}{\ensuremath{\mathcal{W}}}
\newcommand{\cX}{\ensuremath{\mathcal{X}}}
\newcommand{\cY}{\ensuremath{\mathcal{Y}}}
\newcommand{\cZ}{\ensuremath{\mathcal{Z}}}

% blackboard bold letters
\newcommand{\lA}{\ensuremath{\mathbb{A}}}
\newcommand{\lB}{\ensuremath{\mathbb{B}}}
\newcommand{\lC}{\ensuremath{\mathbb{C}}}
\newcommand{\lD}{\ensuremath{\mathbb{D}}}
\newcommand{\lE}{\ensuremath{\mathbb{E}}}
\newcommand{\lF}{\ensuremath{\mathbb{F}}}
\newcommand{\lG}{\ensuremath{\mathbb{G}}}
\newcommand{\lH}{\ensuremath{\mathbb{H}}}
\newcommand{\lI}{\ensuremath{\mathbb{I}}}
\newcommand{\lJ}{\ensuremath{\mathbb{J}}}
\newcommand{\lK}{\ensuremath{\mathbb{K}}}
\newcommand{\lL}{\ensuremath{\mathbb{L}}}
\newcommand{\lM}{\ensuremath{\mathbb{M}}}
\newcommand{\lN}{\ensuremath{\mathbb{N}}}
\newcommand{\lO}{\ensuremath{\mathbb{O}}}
\newcommand{\lP}{\ensuremath{\mathbb{P}}}
\newcommand{\lQ}{\ensuremath{\mathbb{Q}}}
\newcommand{\lR}{\ensuremath{\mathbb{R}}}
\newcommand{\lS}{\ensuremath{\mathbb{S}}}
\newcommand{\lT}{\ensuremath{\mathbb{T}}}
\newcommand{\lU}{\ensuremath{\mathbb{U}}}
\newcommand{\lV}{\ensuremath{\mathbb{V}}}
\newcommand{\lW}{\ensuremath{\mathbb{W}}}
\newcommand{\lX}{\ensuremath{\mathbb{X}}}
\newcommand{\lY}{\ensuremath{\mathbb{Y}}}
\newcommand{\lZ}{\ensuremath{\mathbb{Z}}}

% bold letters
\newcommand{\bA}{\ensuremath{\mathbf{A}}}
\newcommand{\bB}{\ensuremath{\mathbf{B}}}
\newcommand{\bC}{\ensuremath{\mathbf{C}}}
\newcommand{\bD}{\ensuremath{\mathbf{D}}}
\newcommand{\bE}{\ensuremath{\mathbf{E}}}
\newcommand{\bF}{\ensuremath{\mathbf{F}}}
\newcommand{\bG}{\ensuremath{\mathbf{G}}}
\newcommand{\bH}{\ensuremath{\mathbf{H}}}
\newcommand{\bI}{\ensuremath{\mathbf{I}}}
\newcommand{\bJ}{\ensuremath{\mathbf{J}}}
\newcommand{\bK}{\ensuremath{\mathbf{K}}}
\newcommand{\bL}{\ensuremath{\mathbf{L}}}
\newcommand{\bM}{\ensuremath{\mathbf{M}}}
\newcommand{\bN}{\ensuremath{\mathbf{N}}}
\newcommand{\bO}{\ensuremath{\mathbf{O}}}
\newcommand{\bP}{\ensuremath{\mathbf{P}}}
\newcommand{\bQ}{\ensuremath{\mathbf{Q}}}
\newcommand{\bR}{\ensuremath{\mathbf{R}}}
\newcommand{\bS}{\ensuremath{\mathbf{S}}}
\newcommand{\bT}{\ensuremath{\mathbf{T}}}
\newcommand{\bU}{\ensuremath{\mathbf{U}}}
\newcommand{\bV}{\ensuremath{\mathbf{V}}}
\newcommand{\bW}{\ensuremath{\mathbf{W}}}
\newcommand{\bX}{\ensuremath{\mathbf{X}}}
\newcommand{\bY}{\ensuremath{\mathbf{Y}}}
\newcommand{\bZ}{\ensuremath{\mathbf{Z}}}

% fraktur letters
\newcommand{\fa}{\ensuremath{\mathfrak{a}}}
\newcommand{\fb}{\ensuremath{\mathfrak{b}}}
\newcommand{\fc}{\ensuremath{\mathfrak{c}}}
\newcommand{\fd}{\ensuremath{\mathfrak{d}}}
\newcommand{\fe}{\ensuremath{\mathfrak{e}}}
\newcommand{\ff}{\ensuremath{\mathfrak{f}}}
\newcommand{\fg}{\ensuremath{\mathfrak{g}}}
\newcommand{\fh}{\ensuremath{\mathfrak{h}}}
\newcommand{\fj}{\ensuremath{\mathfrak{j}}}
\newcommand{\fk}{\ensuremath{\mathfrak{k}}}
\newcommand{\fl}{\ensuremath{\mathfrak{l}}}
\newcommand{\fm}{\ensuremath{\mathfrak{m}}}
\newcommand{\fn}{\ensuremath{\mathfrak{n}}}
\newcommand{\fo}{\ensuremath{\mathfrak{o}}}
\newcommand{\fp}{\ensuremath{\mathfrak{p}}}
\newcommand{\fq}{\ensuremath{\mathfrak{q}}}
\newcommand{\fr}{\ensuremath{\mathfrak{r}}}
\newcommand{\fs}{\ensuremath{\mathfrak{s}}}
\newcommand{\ft}{\ensuremath{\mathfrak{t}}}
\newcommand{\fu}{\ensuremath{\mathfrak{u}}}
\newcommand{\fv}{\ensuremath{\mathfrak{v}}}
\newcommand{\fw}{\ensuremath{\mathfrak{w}}}
\newcommand{\fx}{\ensuremath{\mathfrak{x}}}
\newcommand{\fy}{\ensuremath{\mathfrak{y}}}
\newcommand{\fz}{\ensuremath{\mathfrak{z}}}

\mdef\fahat{\hat{\fa}}

% Underline letters
\newcommand{\uA}{\ensuremath{\underline{A}}}
\newcommand{\uB}{\ensuremath{\underline{B}}}
\newcommand{\uC}{\ensuremath{\underline{C}}}
\newcommand{\uD}{\ensuremath{\underline{D}}}
\newcommand{\uE}{\ensuremath{\underline{E}}}
\newcommand{\uF}{\ensuremath{\underline{F}}}
\newcommand{\uG}{\ensuremath{\underline{G}}}
\newcommand{\uH}{\ensuremath{\underline{H}}}
\newcommand{\uI}{\ensuremath{\underline{I}}}
\newcommand{\uJ}{\ensuremath{\underline{J}}}
\newcommand{\uK}{\ensuremath{\underline{K}}}
\newcommand{\uL}{\ensuremath{\underline{L}}}
\newcommand{\uM}{\ensuremath{\underline{M}}}
\newcommand{\uN}{\ensuremath{\underline{N}}}
\newcommand{\uO}{\ensuremath{\underline{O}}}
\newcommand{\uP}{\ensuremath{\underline{P}}}
\newcommand{\uQ}{\ensuremath{\underline{Q}}}
\newcommand{\uR}{\ensuremath{\underline{R}}}
\newcommand{\uS}{\ensuremath{\underline{S}}}
\newcommand{\uT}{\ensuremath{\underline{T}}}
\newcommand{\uU}{\ensuremath{\underline{U}}}
\newcommand{\uV}{\ensuremath{\underline{V}}}
\newcommand{\uW}{\ensuremath{\underline{W}}}
\newcommand{\uX}{\ensuremath{\underline{X}}}
\newcommand{\uY}{\ensuremath{\underline{Y}}}
\newcommand{\uZ}{\ensuremath{\underline{Z}}}

% bars
\newcommand{\Abar}{\ensuremath{\overline{A}}}
\newcommand{\Bbar}{\ensuremath{\overline{B}}}
\newcommand{\Cbar}{\ensuremath{\overline{C}}}
\newcommand{\Dbar}{\ensuremath{\overline{D}}}
\newcommand{\Ebar}{\ensuremath{\overline{E}}}
\newcommand{\Fbar}{\ensuremath{\overline{F}}}
\newcommand{\Gbar}{\ensuremath{\overline{G}}}
\newcommand{\Hbar}{\ensuremath{\overline{H}}}
\newcommand{\Ibar}{\ensuremath{\overline{I}}}
\newcommand{\Jbar}{\ensuremath{\overline{J}}}
\newcommand{\Kbar}{\ensuremath{\overline{K}}}
\newcommand{\Lbar}{\ensuremath{\overline{L}}}
\newcommand{\Mbar}{\ensuremath{\overline{M}}}
\newcommand{\Nbar}{\ensuremath{\overline{N}}}
\newcommand{\Obar}{\ensuremath{\overline{O}}}
\newcommand{\Pbar}{\ensuremath{\overline{P}}}
\newcommand{\Qbar}{\ensuremath{\overline{Q}}}
\newcommand{\Rbar}{\ensuremath{\overline{R}}}
\newcommand{\Sbar}{\ensuremath{\overline{S}}}
\newcommand{\Tbar}{\ensuremath{\overline{T}}}
\newcommand{\Ubar}{\ensuremath{\overline{U}}}
\newcommand{\Vbar}{\ensuremath{\overline{V}}}
\newcommand{\Wbar}{\ensuremath{\overline{W}}}
\newcommand{\Xbar}{\ensuremath{\overline{X}}}
\newcommand{\Ybar}{\ensuremath{\overline{Y}}}
\newcommand{\Zbar}{\ensuremath{\overline{Z}}}
\newcommand{\abar}{\ensuremath{\overline{a}}}
\newcommand{\bbar}{\ensuremath{\overline{b}}}
\newcommand{\cbar}{\ensuremath{\overline{c}}}
\newcommand{\dbar}{\ensuremath{\overline{d}}}
\newcommand{\ebar}{\ensuremath{\overline{e}}}
\newcommand{\fbar}{\ensuremath{\overline{f}}}
\newcommand{\gbar}{\ensuremath{\overline{g}}}
%\newcommand{\hbar}{\ensuremath{\overline{h}}} % whoops, \hbar means something else!
\newcommand{\ibar}{\ensuremath{\overline{\imath}}}
\newcommand{\jbar}{\ensuremath{\overline{\jmath}}}
\newcommand{\kbar}{\ensuremath{\overline{k}}}
\newcommand{\lbar}{\ensuremath{\overline{l}}}
\newcommand{\mbar}{\ensuremath{\overline{m}}}
\newcommand{\nbar}{\ensuremath{\overline{n}}}
%\newcommand{\obar}{\ensuremath{\overline{o}}}
\newcommand{\pbar}{\ensuremath{\overline{p}}}
\newcommand{\qbar}{\ensuremath{\overline{q}}}
\newcommand{\rbar}{\ensuremath{\overline{r}}}
\newcommand{\sbar}{\ensuremath{\overline{s}}}
\newcommand{\tbar}{\ensuremath{\overline{t}}}
\newcommand{\ubar}{\ensuremath{\overline{u}}}
\newcommand{\vbar}{\ensuremath{\overline{v}}}
\newcommand{\wbar}{\ensuremath{\overline{w}}}
\newcommand{\xbar}{\ensuremath{\overline{x}}}
\newcommand{\ybar}{\ensuremath{\overline{y}}}
\newcommand{\zbar}{\ensuremath{\overline{z}}}

% tildes
\newcommand{\Atil}{\ensuremath{\widetilde{A}}}
\newcommand{\Btil}{\ensuremath{\widetilde{B}}}
\newcommand{\Ctil}{\ensuremath{\widetilde{C}}}
\newcommand{\Dtil}{\ensuremath{\widetilde{D}}}
\newcommand{\Etil}{\ensuremath{\widetilde{E}}}
\newcommand{\Ftil}{\ensuremath{\widetilde{F}}}
\newcommand{\Gtil}{\ensuremath{\widetilde{G}}}
\newcommand{\Htil}{\ensuremath{\widetilde{H}}}
\newcommand{\Itil}{\ensuremath{\widetilde{I}}}
\newcommand{\Jtil}{\ensuremath{\widetilde{J}}}
\newcommand{\Ktil}{\ensuremath{\widetilde{K}}}
\newcommand{\Ltil}{\ensuremath{\widetilde{L}}}
\newcommand{\Mtil}{\ensuremath{\widetilde{M}}}
\newcommand{\Ntil}{\ensuremath{\widetilde{N}}}
\newcommand{\Otil}{\ensuremath{\widetilde{O}}}
\newcommand{\Ptil}{\ensuremath{\widetilde{P}}}
\newcommand{\Qtil}{\ensuremath{\widetilde{Q}}}
\newcommand{\Rtil}{\ensuremath{\widetilde{R}}}
\newcommand{\Stil}{\ensuremath{\widetilde{S}}}
\newcommand{\Ttil}{\ensuremath{\widetilde{T}}}
\newcommand{\Util}{\ensuremath{\widetilde{U}}}
\newcommand{\Vtil}{\ensuremath{\widetilde{V}}}
\newcommand{\Wtil}{\ensuremath{\widetilde{W}}}
\newcommand{\Xtil}{\ensuremath{\widetilde{X}}}
\newcommand{\Ytil}{\ensuremath{\widetilde{Y}}}
\newcommand{\Ztil}{\ensuremath{\widetilde{Z}}}
\newcommand{\atil}{\ensuremath{\widetilde{a}}}
\newcommand{\btil}{\ensuremath{\widetilde{b}}}
\newcommand{\ctil}{\ensuremath{\widetilde{c}}}
\newcommand{\dtil}{\ensuremath{\widetilde{d}}}
\newcommand{\etil}{\ensuremath{\widetilde{e}}}
\newcommand{\ftil}{\ensuremath{\widetilde{f}}}
\newcommand{\gtil}{\ensuremath{\widetilde{g}}}
\newcommand{\htil}{\ensuremath{\widetilde{h}}}
\newcommand{\itil}{\ensuremath{\widetilde{\imath}}}
\newcommand{\jtil}{\ensuremath{\widetilde{\jmath}}}
\newcommand{\ktil}{\ensuremath{\widetilde{k}}}
\newcommand{\ltil}{\ensuremath{\widetilde{l}}}
\newcommand{\mtil}{\ensuremath{\widetilde{m}}}
\newcommand{\ntil}{\ensuremath{\widetilde{n}}}
\newcommand{\otil}{\ensuremath{\widetilde{o}}}
\newcommand{\ptil}{\ensuremath{\widetilde{p}}}
\newcommand{\qtil}{\ensuremath{\widetilde{q}}}
\newcommand{\rtil}{\ensuremath{\widetilde{r}}}
\newcommand{\stil}{\ensuremath{\widetilde{s}}}
\newcommand{\ttil}{\ensuremath{\widetilde{t}}}
\newcommand{\util}{\ensuremath{\widetilde{u}}}
\newcommand{\vtil}{\ensuremath{\widetilde{v}}}
\newcommand{\wtil}{\ensuremath{\widetilde{w}}}
\newcommand{\xtil}{\ensuremath{\widetilde{x}}}
\newcommand{\ytil}{\ensuremath{\widetilde{y}}}
\newcommand{\ztil}{\ensuremath{\widetilde{z}}}

% Hats
\newcommand{\Ahat}{\ensuremath{\widehat{A}}}
\newcommand{\Bhat}{\ensuremath{\widehat{B}}}
\newcommand{\Chat}{\ensuremath{\widehat{C}}}
\newcommand{\Dhat}{\ensuremath{\widehat{D}}}
\newcommand{\Ehat}{\ensuremath{\widehat{E}}}
\newcommand{\Fhat}{\ensuremath{\widehat{F}}}
\newcommand{\Ghat}{\ensuremath{\widehat{G}}}
\newcommand{\Hhat}{\ensuremath{\widehat{H}}}
\newcommand{\Ihat}{\ensuremath{\widehat{I}}}
\newcommand{\Jhat}{\ensuremath{\widehat{J}}}
\newcommand{\Khat}{\ensuremath{\widehat{K}}}
\newcommand{\Lhat}{\ensuremath{\widehat{L}}}
\newcommand{\Mhat}{\ensuremath{\widehat{M}}}
\newcommand{\Nhat}{\ensuremath{\widehat{N}}}
\newcommand{\Ohat}{\ensuremath{\widehat{O}}}
\newcommand{\Phat}{\ensuremath{\widehat{P}}}
\newcommand{\Qhat}{\ensuremath{\widehat{Q}}}
\newcommand{\Rhat}{\ensuremath{\widehat{R}}}
\newcommand{\Shat}{\ensuremath{\widehat{S}}}
\newcommand{\That}{\ensuremath{\widehat{T}}}
\newcommand{\Uhat}{\ensuremath{\widehat{U}}}
\newcommand{\Vhat}{\ensuremath{\widehat{V}}}
\newcommand{\What}{\ensuremath{\widehat{W}}}
\newcommand{\Xhat}{\ensuremath{\widehat{X}}}
\newcommand{\Yhat}{\ensuremath{\widehat{Y}}}
\newcommand{\Zhat}{\ensuremath{\widehat{Z}}}
\newcommand{\ahat}{\ensuremath{\hat{a}}}
\newcommand{\bhat}{\ensuremath{\hat{b}}}
\newcommand{\chat}{\ensuremath{\hat{c}}}
\newcommand{\dhat}{\ensuremath{\hat{d}}}
\newcommand{\ehat}{\ensuremath{\hat{e}}}
\newcommand{\fhat}{\ensuremath{\hat{f}}}
\newcommand{\ghat}{\ensuremath{\hat{g}}}
\newcommand{\hhat}{\ensuremath{\hat{h}}}
\newcommand{\ihat}{\ensuremath{\hat{\imath}}}
\newcommand{\jhat}{\ensuremath{\hat{\jmath}}}
\newcommand{\khat}{\ensuremath{\hat{k}}}
\newcommand{\lhat}{\ensuremath{\hat{l}}}
\newcommand{\mhat}{\ensuremath{\hat{m}}}
\newcommand{\nhat}{\ensuremath{\hat{n}}}
\newcommand{\ohat}{\ensuremath{\hat{o}}}
\newcommand{\phat}{\ensuremath{\hat{p}}}
\newcommand{\qhat}{\ensuremath{\hat{q}}}
\newcommand{\rhat}{\ensuremath{\hat{r}}}
\newcommand{\shat}{\ensuremath{\hat{s}}}
\newcommand{\that}{\ensuremath{\hat{t}}}
\newcommand{\uhat}{\ensuremath{\hat{u}}}
\newcommand{\vhat}{\ensuremath{\hat{v}}}
\newcommand{\what}{\ensuremath{\hat{w}}}
\newcommand{\xhat}{\ensuremath{\hat{x}}}
\newcommand{\yhat}{\ensuremath{\hat{y}}}
\newcommand{\zhat}{\ensuremath{\hat{z}}}

%% FONTS AND DECORATION FOR GREEK LETTERS

%% the package `mathbbol' gives us blackboard bold greek and numbers,
%% but it does it by redefining \mathbb to use a different font, so that
%% all the other \mathbb letters look different too.  Here we import the
%% font with bb greek and numbers, but assign it a different name,
%% \mathbbb, so as not to replace the usual one.
\DeclareSymbolFont{bbold}{U}{bbold}{m}{n}
\DeclareSymbolFontAlphabet{\mathbbb}{bbold}
\newcommand{\bbDelta}{\ensuremath{\mathbbb{\Delta}}}
\newcommand{\bbone}{\ensuremath{\mathbbb{1}}}
\newcommand{\bbtwo}{\ensuremath{\mathbbb{2}}}
\newcommand{\bbthree}{\ensuremath{\mathbbb{3}}}

% greek with bars
\newcommand{\albar}{\ensuremath{\overline{\alpha}}}
\newcommand{\bebar}{\ensuremath{\overline{\beta}}}
\newcommand{\gmbar}{\ensuremath{\overline{\gamma}}}
\newcommand{\debar}{\ensuremath{\overline{\delta}}}
\newcommand{\phibar}{\ensuremath{\overline{\varphi}}}
\newcommand{\psibar}{\ensuremath{\overline{\psi}}}
\newcommand{\xibar}{\ensuremath{\overline{\xi}}}
\newcommand{\ombar}{\ensuremath{\overline{\omega}}}

% greek with hats
\newcommand{\alhat}{\ensuremath{\hat{\alpha}}}
\newcommand{\behat}{\ensuremath{\hat{\beta}}}
\newcommand{\gmhat}{\ensuremath{\hat{\gamma}}}
\newcommand{\dehat}{\ensuremath{\hat{\delta}}}

% greek with checks
\newcommand{\alchk}{\ensuremath{\check{\alpha}}}
\newcommand{\bechk}{\ensuremath{\check{\beta}}}
\newcommand{\gmchk}{\ensuremath{\check{\gamma}}}
\newcommand{\dechk}{\ensuremath{\check{\delta}}}

% greek with tildes
\newcommand{\altil}{\ensuremath{\widetilde{\alpha}}}
\newcommand{\betil}{\ensuremath{\widetilde{\beta}}}
\newcommand{\gmtil}{\ensuremath{\widetilde{\gamma}}}
\newcommand{\phitil}{\ensuremath{\widetilde{\varphi}}}
\newcommand{\psitil}{\ensuremath{\widetilde{\psi}}}
\newcommand{\xitil}{\ensuremath{\widetilde{\xi}}}
\newcommand{\omtil}{\ensuremath{\widetilde{\omega}}}

% MISCELLANEOUS SYMBOLS
\mdef\del{\partial}
\mdef\delbar{\overline{\partial}}
\let\sm\wedge
\newcommand{\dd}[1]{\ensuremath{\frac{\partial}{\partial {#1}}}}
\newcommand{\inv}{^{-1}}
\newcommand{\dual}{^{\vee}}
\mdef\hf{\textstyle\frac{1}{2}}
\mdef\thrd{\textstyle\frac{1}{3}}
\mdef\qtr{\textstyle\frac{1}{4}}
\let\meet\wedge
\let\join\vee
\let\dn\downarrow
\newcommand{\op}{^{\mathit{op}}}
\newcommand{\co}{^{\mathit{co}}}
\newcommand{\coop}{^{\mathit{coop}}}
\let\adj\dashv
\SelectTips{cm}{}
\newdir{ >}{{}*!/-10pt/@{>}}    % extra spacing for tail arrows in XYpic
\newcommand{\pushoutcorner}[1][dr]{\save*!/#1+1.2pc/#1:(1,-1)@^{|-}\restore}
\newcommand{\pullbackcorner}[1][dr]{\save*!/#1-1.2pc/#1:(-1,1)@^{|-}\restore}
\let\iso\cong
\let\eqv\simeq
\let\cng\equiv
\mdef\Id{\mathrm{Id}}
\mdef\id{\mathrm{id}}
\alwaysmath{ell}
\alwaysmath{infty}
\alwaysmath{odot}
\def\frc#1/#2.{\frac{#1}{#2}}   % \frc x^2+1 / x^2-1 .
\mdef\ten{\mathrel{\otimes}}
\mdef\bigten{\bigotimes}
\mdef\sqten{\mathrel{\boxtimes}}
\def\pow(#1,#2){\mathop{\pitchfork}(#1,#2)} % powers and
\def\cpw{\mathop{\odot}}                    % copowers

%% OPERATORS
\DeclareMathOperator\lan{Lan}
\DeclareMathOperator\ran{Ran}
\DeclareMathOperator\colim{colim}
\DeclareMathOperator\coeq{coeq}
\DeclareMathOperator\eq{eq}
\DeclareMathOperator\Tot{Tot}
\DeclareMathOperator\cosk{cosk}
\DeclareMathOperator\sk{sk}
\DeclareMathOperator\im{im}
\DeclareMathOperator\Spec{Spec}
\DeclareMathOperator\Ho{Ho}
\DeclareMathOperator\Aut{Aut}
\DeclareMathOperator\End{End}
\DeclareMathOperator\Hom{Hom}
\DeclareMathOperator\Map{Map}

%% ARROWS
% \to already exists
\newcommand{\too}[1][]{\ensuremath{\overset{#1}{\longrightarrow}}}
\newcommand{\ot}{\ensuremath{\leftarrow}}
\newcommand{\oot}[1][]{\ensuremath{\overset{#1}{\longleftarrow}}}
\let\toot\rightleftarrows
\let\otto\leftrightarrows
\let\Impl\Rightarrow
\let\imp\Rightarrow
\let\toto\rightrightarrows
\let\into\hookrightarrow
\let\xinto\xhookrightarrow
\mdef\we{\overset{\sim}{\longrightarrow}}
\mdef\leftwe{\overset{\sim}{\longleftarrow}}
\let\mono\rightarrowtail
\let\leftmono\leftarrowtail
\let\cof\rightarrowtail
\let\leftcof\leftarrowtail
\let\epi\twoheadrightarrow
\let\leftepi\twoheadleftarrow
\let\fib\twoheadrightarrow
\let\leftfib\twoheadleftarrow
\let\cohto\rightsquigarrow
\let\maps\colon
\newcommand{\spam}{\,:\!}       % \maps for left arrows

%% EXTENSIBLE ARROWS
\let\xto\xrightarrow
\let\xot\xleftarrow
% See Voss' Mathmode.tex for instructions on how to create new
% extensible arrows.
\def\rightarrowtailfill@{\arrowfill@{\Yright\joinrel\relbar}\relbar\rightarrow}
\newcommand\xrightarrowtail[2][]{\ext@arrow 0055{\rightarrowtailfill@}{#1}{#2}}
\let\xmono\xrightarrowtail
\let\xcof\xrightarrowtail
\def\twoheadrightarrowfill@{\arrowfill@{\relbar\joinrel\relbar}\relbar\twoheadrightarrow}
\newcommand\xtwoheadrightarrow[2][]{\ext@arrow 0055{\twoheadrightarrowfill@}{#1}{#2}}
\let\xepi\xtwoheadrightarrow
\let\xfib\xtwoheadrightarrow
% Let's leave the left-going ones until I need them.

%% EXTENSIBLE SLASHED ARROWS
% Making extensible slashed arrows, by modifying the underlying AMS code.
% Arguments are:
% 1 = arrowhead on the left (\relbar or \Relbar if none)
% 2 = fill character (usually \relbar or \Relbar)
% 3 = slash character (such as \mapstochar or \Mapstochar)
% 4 = arrowhead on the left (\relbar or \Relbar if none)
% 5 = display mode (\displaystyle etc)
\def\slashedarrowfill@#1#2#3#4#5{%
  $\m@th\thickmuskip0mu\medmuskip\thickmuskip\thinmuskip\thickmuskip
   \relax#5#1\mkern-7mu%
   \cleaders\hbox{$#5\mkern-2mu#2\mkern-2mu$}\hfill
   \mathclap{#3}\mathclap{#2}%
   \cleaders\hbox{$#5\mkern-2mu#2\mkern-2mu$}\hfill
   \mkern-7mu#4$%
}
% Here's the idea: \<slashed>arrowfill@ should be a box containing
% some stretchable space that is the "middle of the arrow".  This
% space is created as a "leader" using \cleader<thing>\hfill, which
% fills an \hfill of space with copies of <thing>.  Here instead of
% just one \cleader, we use two, with the slash in between (and an
% extra copy of the filler, to avoid extra space around the slash).
\def\rightslashedarrowfill@{%
  \slashedarrowfill@\relbar\relbar\mapstochar\rightarrow}
\newcommand\xslashedrightarrow[2][]{%
  \ext@arrow 0055{\rightslashedarrowfill@}{#1}{#2}}
\mdef\hto{\xslashedrightarrow{}}
\mdef\htoo{\xslashedrightarrow{\quad}}
\let\xhto\xslashedrightarrow

%% To get a slashed arrow in XYpic, do
% \[\xymatrix{A \ar[r]|-@{|} & B}\]

% ISOMORPHISMS
\def\xiso#1{\mathrel{\mathrlap{\smash{\xto[\smash{\raisebox{1.3mm}{$\scriptstyle\sim$}}]{#1}}}\hphantom{\xto{#1}}}}
\def\toiso{\xto{\smash{\raisebox{-.5mm}{$\scriptstyle\sim$}}}}

% SHADOWS
\def\shvar#1#2{{\ensuremath{%
  \hspace{1mm}\makebox[-1mm]{$#1\langle$}\makebox[0mm]{$#1\langle$}\hspace{1mm}%
  {#2}%
  \makebox[1mm]{$#1\rangle$}\makebox[0mm]{$#1\rangle$}%
}}}
\def\sh{\shvar{}}
\def\scriptsh{\shvar{\scriptstyle}}
\def\bigsh{\shvar{\big}}
\def\Bigsh{\shvar{\Big}}
\def\biggsh{\shvar{\bigg}}
\def\Biggsh{\shvar{\Bigg}}

% THEOREM-TYPE ENVIRONMENTS, hacked to
%% (a) number all with the same numbers, and
%% (b) have the right names for autoref
\def\defthm#1#2{%
  \newtheorem{#1}{#2}[section]%
  \expandafter\def\csname #1autorefname\endcsname{#2}%
  \expandafter\let\csname c@#1\endcsname\c@thm}
\newtheorem{thm}{Theorem}[section]
\newcommand{\thmautorefname}{Theorem}
\defthm{cor}{Corollary}
\defthm{prop}{Proposition}
\defthm{lem}{Lemma}
\defthm{sch}{Scholium}
\defthm{assume}{Assumption}
\defthm{claim}{Claim}
\defthm{conj}{Conjecture}
\defthm{hyp}{Hypothesis}
\defthm{fact}{Fact}
\theoremstyle{definition}
\defthm{defn}{Definition}
\defthm{notn}{Notation}
\theoremstyle{remark}
\defthm{rmk}{Remark}
\defthm{eg}{Example}
\defthm{egs}{Examples}
\defthm{ex}{Exercise}
\defthm{ceg}{Counterexample}

% How to get QED symbols inside equations at the end of the statements
% of theorems.  AMS LaTeX knows how to do this inside equations at the
% end of *proofs* with \qedhere, and at the end of the statement of a
% theorem with \qed (meaning no proof will be given), but it can't
% seem to combine the two.  Use this instead.
\def\thmqedhere{\expandafter\csname\csname @currenvir\endcsname @qed\endcsname}

% Number numbered lists as (i), (ii), ...
\renewcommand{\theenumi}{(\roman{enumi})}
\renewcommand{\labelenumi}{\theenumi}

%% Labeling that keeps track of theorem-type names.  Superseded by
%% autoref from hyperref, as above, but we keep this in case we are
%% using a journal style file that is incompatible with hyperref.
% 
% \ifx\SK@label\undefined\let\SK@label\label\fi
% \let\your@thm\@thm
% \def\@thm#1#2#3{\gdef\currthmtype{#3}\your@thm{#1}{#2}{#3}}
% \def\xlabel#1{{\let\your@currentlabel\@currentlabel\def\@currentlabel
% {\currthmtype~\your@currentlabel}
% \SK@label{#1@}}\label{#1}}
% \def\xref#1{\ref{#1@}}

% Also number formulas with the theorem counter
\let\c@equation\c@thm
\numberwithin{equation}{section}

% Only show numbers for equations that are actually referenced (or
% whose tags are specified manually) - uses mathtools.
\mathtoolsset{showonlyrefs,showmanualtags}

%% Fix enumerate spacing with paralist.  This has two parts:
%%   1. enable mixing of "old spacing" lists with those adjusted by paralist
%%   2. allow us to specify a number based on which to adjust the spacing
%% For the first, use \killspacingtrue when you want the spacing
%% adjusted, then \killspacingfalse to turn adjustment off.  For the
%% second, use \maxenum=14 to set the widest number you want the
%% spacing to be calculated with.
\newlength\oldleftmargini       % save old spacing
\newlength\oldleftmarginii
\newlength\oldleftmarginiii
\newlength\oldleftmarginiv
\newlength\oldleftmarginv
\newlength\oldleftmarginvi
\newcount\maxenum
\maxenum=7
\newif\ifkillspacing
\def\@adjust@enum@labelwidth{%
  \advance\@listdepth by 1\relax
  \ifkillspacing                % do the paralist thing
    \csname c@\@enumctr\endcsname\maxenum
    \settowidth{\@tempdima}{%
      \csname label\@enumctr\endcsname\hspace{\labelsep}}%
    \csname leftmargin\romannumeral\@listdepth\endcsname
      \@tempdima
  \else                         % otherwise, reset it
    \csname fixspacing\romannumeral\@listdepth\endcsname
  \fi
  \advance\@listdepth by -1\relax}
% these commands, one for each enum level (I couldn't get a generic
% one to work), test whether oldleftmargin has been set yet, and if
% not, set it from leftmargin; otherwise, they reset leftmargin to
% it.  Just setting oldleftmargin to leftmargin in the preamble
% doesn't seem to work.
\def\fixspacingi{\ifnum\oldleftmargini=0\setlength\oldleftmargini\leftmargini\else\setlength\leftmargini\oldleftmargini\fi}
\def\fixspacingii{\ifnum\oldleftmarginii=0\setlength\oldleftmarginii\leftmarginii\else\setlength\leftmarginii\oldleftmarginii\fi}
\def\fixspacingiii{\ifnum\oldleftmarginiii=0\setlength\oldleftmarginiii\leftmarginiii\else\setlength\leftmarginiii\oldleftmarginiii\fi}
\def\fixspacingiv{\ifnum\oldleftmarginiv=0\setlength\oldleftmarginiv\leftmarginiv\else\setlength\leftmarginiv\oldleftmarginiv\fi}
\def\fixspacingv{\ifnum\oldleftmarginv=0\setlength\oldleftmarginv\leftmarginv\else\setlength\leftmarginv\oldleftmarginv\fi}
\def\fixspacingvi{\ifnum\oldleftmarginvi=0\setlength\oldleftmarginvi\leftmarginvi\else\setlength\leftmarginvi\oldleftmarginvi\fi}

%% Fix paralist references, so that we can refer to (1) instead of
%% just 1.
\def\pl@label#1#2{%
  \edef\pl@the{\noexpand#1{\@enumctr}}%
  \pl@lab\expandafter{\the\pl@lab\csname yourthe\@enumctr\endcsname}%
  \advance\@tempcnta1
  \pl@loop}
\def\@enumlabel@#1[#2]{%
  \@plmylabeltrue
  \@tempcnta0
  \pl@lab{}%
  \let\pl@the\pl@qmark
  \expandafter\pl@loop\@gobble#2\@@@
  \ifnum\@tempcnta=1\else
    \PackageWarning{paralist}{Incorrect label; no or multiple
      counters.\MessageBreak The label is: \@gobble#2}%
  \fi
  \expandafter\edef\csname label\@enumctr\endcsname{\the\pl@lab}%
  \expandafter\edef\csname the\@enumctr\endcsname{\the\pl@lab}%
  \expandafter\let\csname yourthe\@enumctr\endcsname\pl@the
  #1}


% GREEK LETTERS, ETC.
\alwaysmath{alpha}
\alwaysmath{beta}
\alwaysmath{gamma}
\alwaysmath{Gamma}
\alwaysmath{delta}
\alwaysmath{Delta}
\alwaysmath{epsilon}
\mdef\ep{\varepsilon}
\alwaysmath{zeta}
\alwaysmath{eta}
\alwaysmath{theta}
\alwaysmath{Theta}
\alwaysmath{iota}
\alwaysmath{kappa}
\alwaysmath{lambda}
\alwaysmath{Lambda}
\alwaysmath{mu}
\alwaysmath{nu}
\alwaysmath{xi}
\alwaysmath{pi}
\alwaysmath{rho}
\alwaysmath{sigma}
\alwaysmath{Sigma}
\alwaysmath{tau}
\alwaysmath{upsilon}
\alwaysmath{Upsilon}
\alwaysmath{phi}
\alwaysmath{Pi}
\alwaysmath{Phi}
\mdef\ph{\varphi}
\alwaysmath{chi}
\alwaysmath{psi}
\alwaysmath{Psi}
\alwaysmath{omega}
\alwaysmath{Omega}
\let\al\alpha
\let\be\beta
\let\gm\gamma
\let\Gm\Gamma
\let\de\delta
\let\De\Delta
\let\si\sigma
\let\Si\Sigma
\let\om\omega
\let\ka\kappa
\let\la\lambda
\let\La\Lambda
\let\ze\zeta
\let\th\theta
\let\Th\Theta
\let\vth\vartheta

\makeatother

% Local Variables:
% mode: latex
% TeX-master: ""
% End:
